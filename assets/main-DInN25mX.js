import"./modulepreload-polyfill-B5Qt9EMX.js";function i(o){window.location.href=`/pwa-sheets-helloworld/${o}`}const l="https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.file";class s{static async signIn(e){return new Promise((t,a)=>{if(!window.google||!window.google.accounts?.oauth2){a("Google Identity Services não carregado.");return}window.google.accounts.oauth2.initTokenClient({client_id:e,scope:l,prompt:"consent",callback:async r=>{if(r.error){a(r.error);return}const c=r.access_token;try{const n=await s.fetchUserInfo(c);localStorage.setItem("accessToken",c),localStorage.setItem("user",JSON.stringify({name:n.name,email:n.email,picture:n.picture,exp:Math.floor(Date.now()/1e3)+3600})),t()}catch(n){a("Erro ao obter dados do usuário: "+n)}}}).requestAccessToken()})}static async fetchUserInfo(e){const t=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Falha ao buscar dados do usuário");return await t.json()}static getToken(){return localStorage.getItem("accessToken")}static getUser(){const e=localStorage.getItem("user");if(!e)return null;try{const t=JSON.parse(e);return{name:t.name,email:t.email,picture:t.picture}}catch{return null}}static isAuthenticated(){const e=localStorage.getItem("user");if(!e)return!1;try{const{exp:t}=JSON.parse(e),a=Math.floor(Date.now()/1e3);return t>a}catch{return!1}}static logout(){localStorage.clear(),i("/index.html")}}const u="338305920567-bhd608ebcip1u08qf0gb5f08o4je4dnp.apps.googleusercontent.com";window.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("loginStatus"),e=document.getElementById("googleSignInBtn");e&&e.addEventListener("click",async()=>{try{o.textContent="Carregando autenticação...",o.className="alert alert-info",await s.signIn(u),o.textContent="Login realizado com sucesso!",o.className="alert alert-success",i("src/presentation/pages/cadastro.html")}catch(t){console.error("Erro no login:",t),o.textContent="Erro ao autenticar. Tente novamente.",o.className="alert alert-danger"}})});
