(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function o(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(e){if(e.ep)return;e.ep=!0;const s=o(e);fetch(e.href,s)}})();const c="https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.metadata.readonly";class a{static clientId="338305920567-bhd608ebcip1u08qf0gb5f08o4je4dnp.apps.googleusercontent.com";static init(){(!window.google||!window.google.accounts||!window.google.accounts.oauth2)&&console.warn("Google Identity Services ainda não carregado.")}static isAuthenticated(){const t=localStorage.getItem("accessToken"),o=localStorage.getItem("accessTokenExpiresAt");return!!t&&!!o&&Date.now()<Number(o)}static async authenticate(){await this.ensureValidToken()||await this.interactiveLogin()}static async interactiveLogin(){return new Promise((t,o)=>{window.google.accounts.oauth2.initTokenClient({client_id:this.clientId,scope:c,prompt:"consent",callback:async e=>{if(e.error){o(new Error("Erro ao obter access token"));return}this.storeCredentials(e.access_token,e.expires_in);try{const s=await this.fetchUserInfo(e.access_token);localStorage.setItem("user",JSON.stringify(s)),t()}catch(s){o(s)}}}).requestAccessToken()})}static async ensureValidToken(){return this.isAuthenticated()?!0:new Promise(t=>{window.google.accounts.oauth2.initTokenClient({client_id:this.clientId,scope:c,prompt:"",callback:async r=>{if(r.error||!r.access_token)t(!1);else{if(this.storeCredentials(r.access_token,r.expires_in),!localStorage.getItem("user"))try{const e=await this.fetchUserInfo(r.access_token);localStorage.setItem("user",JSON.stringify(e))}catch(e){console.warn("Falha ao buscar informações do usuário no login silencioso:",e)}t(!0)}}}).requestAccessToken()})}static getAccessToken(){const t=localStorage.getItem("accessToken");if(!t)throw new Error("Token de acesso não encontrado.");return t}static getUser(){const t=localStorage.getItem("user");if(!t)return null;try{const o=JSON.parse(t);return{name:o.name,email:o.email,picture:o.picture}}catch{return null}}static logout(){localStorage.removeItem("accessToken"),localStorage.removeItem("accessTokenExpiresAt"),localStorage.removeItem("user"),window.location.href="/login.html"}static storeCredentials(t,o){localStorage.setItem("accessToken",t);const r=Date.now()+(o||3600)*1e3;localStorage.setItem("accessTokenExpiresAt",r.toString())}static async fetchUserInfo(t){const o=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t}`}});if(!o.ok)throw new Error("Erro ao obter dados do usuário");return o.json()}}export{a as G};
