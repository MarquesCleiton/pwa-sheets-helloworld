import"./navigation-BiZBkmgm.js";import{l as N,S as T}from"./loadNavbar-CnyS9KZm.js";import{DriveClient as A}from"./DriveClient-PNd5-b1r.js";const z="1zId11Ydti8d0FOQoQjd9lQmPo6GiJx26",h="Cadastro",B="/pwa-sheets-helloworld/",t=e=>document.querySelector(e),y=t("#cadastroForm"),F=t("#nome"),U=t("#email"),$=t("#obs"),o=t("#imagem"),u=t("#imgDrop"),r=t("#imgPreview"),p=t("#imgDelete"),Q=t("#imgRetake"),H=t("#imgActions"),I=t("#imgPlaceholder"),m=t("#authAlert"),O=t("#status"),n=t("#btnSalvar"),j=t("#btnSair");document.addEventListener("DOMContentLoaded",()=>{N(),console.log("[Cadastro] Navbar carregada.")});function w(e,a="warning"){m&&(m.className=`alert alert-${a}`,m.textContent=e,m.classList.remove("d-none"),console.log("[Cadastro] ALERT:",a,e))}function G(){m?.classList.add("d-none")}function i(e){O&&(O.textContent=e),console.log("[Cadastro] STATUS:",e)}function _(e){I?.classList.add("d-none"),r&&(r.src=e,r.classList.remove("d-none")),p?.classList.remove("d-none"),H?.classList.remove("d-none"),u&&(u.style.minHeight="220px")}function b(){o&&(o.value=""),r&&(r.src="",r.classList.add("d-none")),p?.classList.add("d-none"),H?.classList.add("d-none"),I?.classList.remove("d-none"),u&&(u.style.minHeight="140px")}u?.addEventListener("click",e=>{e.target.closest("#imgDelete")||o?.click()});Q?.addEventListener("click",()=>o?.click());p?.addEventListener("click",e=>{e.stopPropagation(),b()});o?.addEventListener("change",()=>{const e=o.files?.[0];if(!e){b();return}const a=URL.createObjectURL(e);_(a),console.log("[Cadastro] Preview atualizado:",{name:e.name,type:e.type,size:e.size})});j?.addEventListener("click",()=>{console.log("[Cadastro] Logout");try{localStorage.removeItem("user"),localStorage.removeItem("accessToken")}catch{}window.location.href=`${B}index.html`});const P=new A;let L=!1;y?.addEventListener("submit",async e=>{if(e.preventDefault(),L)return;L=!0,G(),i("");const a=new T;n&&(n.disabled=!0,n.innerHTML='<span class="spinner-border spinner-border-sm me-1"></span>Salvando…');try{const g=(F?.value||"").trim(),c=(U?.value||"").trim(),R=($?.value||"").trim();if(!g||!c){w("Preencha Nome e E-mail.","warning");return}i("Carregando cabeçalhos…");const E=await a.getHeaders(h),f=o?.files?.[0]||null;let v="";if(f){if(!f.type.startsWith("image/"))throw new Error("Selecione uma imagem válida.");if(f.size>5*1024*1024)throw new Error("Imagem muito grande (máx. 5 MB).");i("Enviando imagem…");const s=await P.uploadImage(f,z);await P.setPublic(s.id),v=A.viewUrl(s.id)}const M=E.map(s=>String(s||"").toLowerCase()),l=s=>{const x=M.indexOf(s.toLowerCase());return x>=0?E[x]:null},d={},S=l("Nome");S&&(d[S]=g);const C=l("Email");C&&(d[C]=c);const D=l("Observações")||l("Observacoes");D&&(d[D]=R);const k=l("Imagem");k&&v&&(d[k]=v),i("Gravando cadastro…"),await a.appendRowByHeader(h,d),await a.upsertMetaSheet(h),w("Cadastro criado com sucesso!","success"),i("Cadastro criado com sucesso!"),b(),y?.reset()}catch(g){const c=g;console.error("[Cadastro] Erro:",c),w(c?.message||"Erro ao salvar cadastro.","danger"),i("")}finally{L=!1,n&&(n.disabled=!1,n.innerHTML='<i class="bi bi-check2-circle me-1"></i>Salvar')}});
