import{G as M}from"./GoogleAuthManager-ldm7OoR_.js";import{S as z}from"./SheetsClient-DdnXSBEg.js";import{l as D}from"./loadNavbar-6w5EyZrw.js";import{b as I}from"./navigation-Cl-AB2MO.js";const v="Cadastro",d=a=>document.querySelector(a),f=a=>{if(!a)return"";try{return a.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().trim()}catch{return a.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}};document.addEventListener("DOMContentLoaded",async()=>{try{await D?.()}catch{}const a=d("#tbody"),x=d("#q"),m=d("#btnAtualizar"),L=d("#btnSair"),c=d("#alert");if(!a)return;const l=(t,n="warning")=>{c&&(c.className=`alert alert-${n}`,c.textContent=t,c.classList.remove("d-none"))},N=()=>c?.classList.add("d-none"),u=t=>{m&&(m.disabled=t,m.textContent=t?"Carregando...":"Atualizar")};let s=[];const C=new z,y=async()=>{N(),u(!0);try{s=(await C.getObjectsWithIndex(v)||[]).map(({rowIndex:n,object:e})=>{const r=e.Nome??e?.nome??"",p=e.Email??e?.email??"",b=e.Observacoes??e.Observações??e?.observacoes??e?.observações??"";return{rowIndex:n,nome:r,email:p,observacoes:b}}).filter(n=>[n.nome,n.email,n.observacoes].some(e=>String(e).trim()!=="-")),g()}catch(t){l(t?.message||"Não foi possível carregar os usuários.","danger")}finally{u(!1)}},A=t=>{const n=new URL(I?.("src/presentation/pages/editar.html"),window.location.origin);n.searchParams.set("tab",v),n.searchParams.set("rowIndex",String(t)),console.log(n.toString()),window.location.href=n.toString()},S=async t=>{if(t<1)return l("rowIndex inválido para exclusão.","danger");if(confirm("Marcar esta linha como excluída? (os campos serão substituídos por '-')")){u(!0);try{await C.softDeleteRowByIndex(v,t),s=s.filter(n=>n.rowIndex!==t),g(),l("Linha marcada como excluída.","success")}catch(n){l(n?.message||"Erro ao excluir.","danger")}finally{u(!1)}}},g=()=>{if(!a)return;if(a.innerHTML="",!s.length){l('Nenhum usuário encontrado na aba "Cadastro".');return}const t=f(x?.value||""),n=t?s.filter(e=>f(e.nome).includes(t)||f(e.email).includes(t)||f(e.observacoes).includes(t)):s;for(const e of n){const r=document.createElement("tr"),p=document.createElement("td");p.textContent=e.nome||"—";const b=document.createElement("td");b.textContent=e.email||"—";const w=document.createElement("td");w.textContent=e.observacoes||"—";const E=document.createElement("td");E.className="text-end";const h=document.createElement("div");h.className="d-inline-flex align-items-center gap-1";const o=document.createElement("button");o.type="button",o.className="btn btn-outline-primary btn-sm",o.setAttribute("aria-label","Editar"),o.innerHTML='<i class="bi bi-pencil-square"></i><span class="visually-hidden">Editar</span>',o.addEventListener("click",()=>A(e.rowIndex));const i=document.createElement("button");i.type="button",i.className="btn btn-outline-danger btn-sm",i.setAttribute("aria-label","Excluir"),i.innerHTML='<i class="bi bi-trash"></i><span class="visually-hidden">Excluir</span>',i.addEventListener("click",()=>S(e.rowIndex)),h.appendChild(o),h.appendChild(i),E.appendChild(h),r.appendChild(p),r.appendChild(b),r.appendChild(w),r.appendChild(E),a.appendChild(r)}};m?.addEventListener("click",y),x?.addEventListener("input",()=>g()),L?.addEventListener("click",async()=>{await M.logout?.(),location.reload()}),y()});
