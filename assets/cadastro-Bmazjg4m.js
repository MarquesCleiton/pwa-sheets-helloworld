import"./GoogleAuthManager-YBajxLns.js";import{S as R}from"./SheetsClient-BqbA6fvN.js";import{D}from"./DriveClient-Dwxo1zcO.js";import{l as M}from"./loadNavbar-6w5EyZrw.js";import"./navigation-Cl-AB2MO.js";const e=s=>document.querySelector(s),T=e("#cadastroForm"),U=e("#nome"),F=e("#email"),$=e("#obs"),n=e("#imagem"),d=e("#imgDrop"),o=e("#imgPreview"),b=e("#imgDelete"),j=e("#imgRetake"),H=e("#imgActions"),O=e("#imgPlaceholder"),m=e("#authAlert"),y=e("#status"),i=e("#btnSalvar");function p(s,t="warning"){m&&(m.className=`alert alert-${t}`,m.textContent=s,m.classList.remove("d-none"))}function q(){m?.classList.add("d-none")}function l(s){y&&(y.textContent=s)}function z(s){O?.classList.add("d-none"),o&&(o.src=s,o.classList.remove("d-none")),b?.classList.remove("d-none"),H?.classList.remove("d-none"),d&&(d.style.minHeight="220px")}function x(){n&&(n.value=""),o&&(o.src="",o.classList.add("d-none")),b?.classList.add("d-none"),H?.classList.add("d-none"),O?.classList.remove("d-none"),d&&(d.style.minHeight="140px")}document.addEventListener("DOMContentLoaded",()=>{M(),d?.addEventListener("click",t=>{t.target.closest("#imgDelete")||n?.click()}),j?.addEventListener("click",()=>n?.click()),b?.addEventListener("click",t=>{t.stopPropagation(),x()}),n?.addEventListener("change",()=>{const t=n.files?.[0];if(!t){x();return}const u=URL.createObjectURL(t);z(u)}),document.getElementById("btnSair")?.addEventListener("click",()=>{try{localStorage.removeItem("user"),localStorage.removeItem("accessToken")}catch{}window.location.href="/index.html"})});const w=new D,G=w.ensurePath(["Cadastro","Imagens"]);let L=!1;T?.addEventListener("submit",async s=>{if(s.preventDefault(),L)return;L=!0,q(),l("");const t="Cadastro",u=new R;i&&(i.disabled=!0,i.innerHTML='<span class="spinner-border spinner-border-sm me-1"></span>Salvando…');try{const f=(U?.value||"").trim(),v=(F?.value||"").trim(),A=($?.value||"").trim();if(!f||!v){p("Preencha Nome e E-mail.","warning");return}const[E,B]=await Promise.all([u.getHeaders(t),G]),g=n?.files?.[0]||null;let h="";if(g){if(!g.type.startsWith("image/"))throw new Error("Selecione uma imagem válida.");if(g.size>5*1024*1024)throw new Error("Imagem muito grande (máx. 5 MB).");l("Enviando imagem…");const a=await w.uploadImage(g,B);await w.setPublic(a.id),h=D.viewUrl(a.id)}const N=E.map(a=>a.toLowerCase()),r=a=>{const k=N.indexOf(a.toLowerCase());return k>=0?E[k]:null},c={},S=r("Nome");S&&(c[S]=f);const C=r("Email");C&&(c[C]=v);const I=r("Observações")||r("Observacoes");I&&(c[I]=A);const P=r("Imagem");P&&h&&(c[P]=h),l("Gravando cadastro…"),await u.appendRowByHeader(t,c),p("Cadastro criado com sucesso!","success"),l("Cadastro criado com sucesso!")}catch(f){p(f?.message||"Erro ao salvar cadastro.","danger"),l("")}finally{L=!1,i&&(i.disabled=!1,i.innerHTML='<i class="bi bi-check2-circle me-1"></i>Salvar')}});
