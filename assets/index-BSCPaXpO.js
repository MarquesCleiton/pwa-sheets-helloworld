(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(e){if(e.ep)return;e.ep=!0;const r=t(e);fetch(e.href,r)}})();class i{static clientId;static init(o){if(this.clientId=o,!window.google||!window.google.accounts?.id){console.error("Google Identity Services não foi carregado.");return}window.google.accounts.id.initialize({client_id:this.clientId,callback:this.handleCredentialResponse.bind(this),auto_select:!1});const t=document.getElementById("googleSignInBtn");t&&window.google.accounts.id.renderButton(t,{theme:"outline",size:"large",type:"standard"}),window.google.accounts.id.prompt()}static handleCredentialResponse(o){const t=o.credential;if(!t){console.error("Token inválido no login.");return}const n=i.decodeJwt(t);localStorage.setItem("token",t),localStorage.setItem("user",JSON.stringify({name:n.name,email:n.email,picture:n.picture,exp:n.exp})),window.location.href="/pwa-sheets-helloworld/pages/cadastro.html"}static isAuthenticated(){const o=localStorage.getItem("token"),t=localStorage.getItem("user");if(!o||!t)return!1;try{const{exp:n}=JSON.parse(t),e=Math.floor(Date.now()/1e3);return n>e}catch{return!1}}static getUser(){const o=localStorage.getItem("user");if(!o)return null;try{const t=JSON.parse(o);return{name:t.name,email:t.email,picture:t.picture}}catch{return null}}static getToken(){return localStorage.getItem("token")}static logout(){localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login.html"}static decodeJwt(o){const n=o.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),e=decodeURIComponent(atob(n).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(e)}}const c="338305920567-bhd608ebcip1u08qf0gb5f08o4je4dnp.apps.googleusercontent.com";window.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("loginStatus"),o=setInterval(async()=>{if(window.google&&window.google.accounts?.id){clearInterval(o);try{await i.init(c),i.isAuthenticated()&&(a.textContent="Você já está logado!",a.className="alert alert-success",window.location.href="/pwa-sheets-helloworld/pages/cadastro.html")}catch(t){console.error("Erro na inicialização do login:",t),a.textContent="Erro ao carregar autenticação.",a.className="alert alert-danger"}}},100)});
