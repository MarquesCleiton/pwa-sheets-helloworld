import{G as g,b as w}from"./navigation-BiZBkmgm.js";class h{sheetId;static META_TAB="Metadados";constructor(t="19B2aMGrajvhPJfOvYXt059-fECytaN38iFsP8GInD_g"){this.sheetId=t}async getAccessToken(){await g.authenticate();const t=g.getAccessToken();if(!t)throw new Error("Token de acesso inválido ou ausente (Sheets).");return t}async getHeadersInit(){return{Authorization:`Bearer ${await this.getAccessToken()}`,"Content-Type":"application/json",Accept:"application/json"}}async request(t,o="GET",e){const n=await this.getHeadersInit(),s=await fetch(t,{method:o,headers:n,body:e?JSON.stringify(e):void 0});if(console.log(s),!s.ok){let r={};try{r=await s.json()}catch{}throw console.error("Erro na requisição ao Google Sheets:",r),new Error(r?.error?.message||`Erro ao acessar o Google Sheets (HTTP ${s.status}).`)}if(!(s.headers.get("content-type")||"").includes("application/json"))try{const r=await s.text();return r?JSON.parse(r):void 0}catch{return}return await s.json()}async getSheetMatrix(t){const o=encodeURIComponent(t),e=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${o}?majorDimension=ROWS`;return(await this.request(e,"GET")).values??[]}async getHeaders(t){const o=await this.getSheetMatrix(t);return o.length===0?[]:(o[0]??[]).map((n,s)=>{const a=String(n??"").trim();return a.length?a:`col_${s+1}`})}async getObjectsWithIndex(t){const o=await this.getSheetMatrix(t);if(o.length===0)return[];const e=await this.getHeaders(t),n=[];for(let s=1;s<o.length;s++){const r=(o[s]??[]).slice(0,e.length);for(;r.length<e.length;)r.push("");const c={};e.forEach((l,i)=>c[l]=r[i]??""),n.push({rowIndex:s,rowNumberA1:s+1,object:c})}return n}async getObjectByIndex(t,o){if(!Number.isInteger(o)||o<1)throw new Error("rowIndex inválido (0 é o cabeçalho; use >= 1).");const e=await this.getHeaders(t);if(e.length===0)throw new Error(`Cabeçalho da aba "${t}" não encontrado.`);const n=this.colToA1(e.length-1),s=`${t}!A${o+1}:${n}${o+1}`,a=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(s)}?majorDimension=ROWS`,c=(await this.request(a,"GET")).values?.[0]??[];if(c.length===0||c.every(d=>d===""||d==null))return null;const i=c.slice(0,e.length);for(;i.length<e.length;)i.push("");const u={};return e.forEach((d,m)=>{u[d]=String(i[m]??"")}),{rowIndex:o,rowNumberA1:o+1,object:u}}mapObjectToRow(t,o){return o.map(e=>t[e]??"")}async appendRowByHeader(t,o){const e=await this.getHeaders(t);if(e.length===0)throw new Error("Cabeçalhos não encontrados na planilha.");const n=[this.mapObjectToRow(o,e)],s=`${t}!A1`,a=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(s)}:append?valueInputOption=RAW`;await this.request(a,"POST",{values:n})}colToA1(t){let o="",e=t;for(;e>=0;)o=String.fromCharCode(e%26+65)+o,e=Math.floor(e/26)-1;return o}async getRowArrayByIndex(t,o){const e=await this.getHeaders(t);if(e.length===0)return null;const n=this.colToA1(e.length-1),s=`${t}!A${o+1}:${n}${o+1}`,a=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(s)}?majorDimension=ROWS`,c=(await this.request(a,"GET")).values?.[0]??[];return c.length===0||c.every(i=>i===""||i==null)?null:c.map(i=>(i??"").toString())}async updateRowByIndex(t,o,e){if(!Number.isInteger(o)||o<1)throw new Error("rowIndex inválido (0 é cabeçalho; use >= 1).");const n=await this.getHeaders(t);if(n.length===0)throw new Error(`Cabeçalho da aba "${t}" não encontrado.`);const s=await this.getRowArrayByIndex(t,o);if(!s)throw new Error(`Linha ${o} não existe (ou está totalmente vazia).`);const a=n.map((i,u)=>{const d=Object.prototype.hasOwnProperty.call(e,i);return String(d?e[i]??"":s[u]??"")}),r=this.colToA1(n.length-1),c=`${t}!A${o+1}:${r}${o+1}`,l=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(c)}?valueInputOption=USER_ENTERED`;await this.request(l,"PUT",{range:c,majorDimension:"ROWS",values:[a]})}async softDeleteRowByIndex(t,o){if(!Number.isInteger(o)||o<1)throw new Error("rowIndex inválido (0 é cabeçalho; use >= 1).");const e=await this.getHeaders(t);if(e.length===0)throw new Error(`Cabeçalho da aba "${t}" não encontrado.`);if(!await this.getRowArrayByIndex(t,o))throw new Error(`Linha ${o} não existe (ou está totalmente vazia).`);const s=e.map(()=>"-"),a=this.colToA1(e.length-1),r=`${t}!A${o+1}:${a}${o+1}`,c=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(r)}?valueInputOption=USER_ENTERED`;await this.request(c,"PUT",{range:r,majorDimension:"ROWS",values:[s]})}metaCacheKey(){return`sheets:${this.sheetId}:meta`}getMetaLocal(){try{const t=localStorage.getItem(this.metaCacheKey());return t?JSON.parse(t):{}}catch{return{}}}setMetaLocal(t){localStorage.setItem(this.metaCacheKey(),JSON.stringify(t))}upsertMetaLocalEntry(t,o){const e=this.getMetaLocal();e[t]=o,this.setMetaLocal(e)}async buildMetaLocalFromSheet(){const t=await this.getObjectsWithIndex(h.META_TAB),o={};for(const e of t){const n=String(e.object?.SheetName||"").trim();if(!n)continue;const s=String(e.object?.UltimaModificacao||"").trim();o[n]={index:e.rowIndex,lastMod:s}}return this.setMetaLocal(o),o}async getMetaLastModByIndexFast(t){if(!Number.isInteger(t)||t<1)throw new Error("rowIndex inválido para Metadados (>= 1).");const o=t+1,e=`${h.META_TAB}!B${o}:B${o}`,n=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(e)}?majorDimension=ROWS`,a=(await this.request(n,"GET")).values?.[0]?.[0]??"",r=String(a??"").trim();return r.length?r:null}async upsertMetaSheet(t,o){const e=o??new Date().toISOString(),n=this.getMetaLocal()[t];if(n&&Number.isInteger(n.index)&&n.index>=1){const l=n.index+1,i=`${h.META_TAB}!B${l}:B${l}`,u=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(i)}?valueInputOption=USER_ENTERED`;return await this.request(u,"PUT",{range:i,majorDimension:"ROWS",values:[[e]]}),{index:n.index,lastMod:e}}const s=await this.getObjectsWithIndex(h.META_TAB);let a=null;for(const l of s)if(String(l.object?.SheetName||"").trim()===t){a={rowIndex:l.rowIndex,rowNumberA1:l.rowNumberA1};break}if(a){const l=`${h.META_TAB}!B${a.rowNumberA1}:B${a.rowNumberA1}`,i=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(l)}?valueInputOption=USER_ENTERED`;return await this.request(i,"PUT",{range:l,majorDimension:"ROWS",values:[[e]]}),{index:a.rowIndex,lastMod:e}}const r=`${h.META_TAB}!A1`,c=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(r)}:append?valueInputOption=USER_ENTERED`;return await this.request(c,"POST",{values:[[t,e]]}),{index:-1,lastMod:e}}async upsertMetaLocal(t){const o=this.getMetaLocal(),e=o[t];if(e&&Number.isInteger(e.index)&&e.index>=1){const s=await this.getMetaLastModByIndexFast(e.index);if(s&&s!==e.lastMod){const a={index:e.index,lastMod:s},r={...o,[t]:a};return this.setMetaLocal(r),a}return e??null}return(await this.buildMetaLocalFromSheet())[t]??null}}async function y(){console.log("Carregando Navbar");const p=await fetch(w("src/presentation/componentes/navbar.html")).then(s=>s.text()),t=document.createElement("div");t.innerHTML=p;const o=t.querySelector("nav");if(!o)return;const e=o.querySelectorAll(".nav-link"),n=window.location.pathname;e.forEach(s=>{const a=s.getAttribute("href");a&&n.includes(a)&&(s.classList.add("nav-active"),s.addEventListener("click",r=>{r.preventDefault()}))}),document.body.appendChild(o),document.body.style.paddingBottom="70px"}export{h as S,y as l};
