import{G as g}from"./GoogleAuthManager-ldm7OoR_.js";class m{sheetId;constructor(e="19B2aMGrajvhPJfOvYXt059-fECytaN38iFsP8GInD_g"){this.sheetId=e}async getAccessToken(){await g.authenticate();const e=g.getAccessToken();if(!e)throw new Error("Token de acesso inválido ou ausente.");return e}async getHeadersInit(){return{Authorization:`Bearer ${await this.getAccessToken()}`,"Content-Type":"application/json",Accept:"application/json"}}async request(e,t="GET",s){const r=await this.getHeadersInit(),o=await fetch(e,{method:t,headers:r,body:s?JSON.stringify(s):void 0});if(!o.ok){let n={};try{n=await o.json()}catch{}throw console.error("Erro na requisição ao Google Sheets:",n),new Error(n?.error?.message||`Erro ao acessar o Google Sheets (HTTP ${o.status}).`)}if(!(o.headers.get("content-type")||"").includes("application/json"))try{const n=await o.text();return n?JSON.parse(n):void 0}catch{return}return await o.json()}async getSheetMatrix(e){const t=encodeURIComponent(e),s=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${t}?majorDimension=ROWS`;return(await this.request(s,"GET")).values??[]}async getHeaders(e){const t=await this.getSheetMatrix(e);return t.length===0?[]:(t[0]??[]).map((r,o)=>{const a=String(r??"").trim();return a.length?a:`col_${o+1}`})}async getSheetObjects(e){const t=await this.getSheetMatrix(e);if(t.length===0)return[];const s=(t[0]??[]).map((a,n)=>{const i=String(a??"").trim();return i.length?i:`col_${n+1}`}),r=t.slice(1),o=[];for(const a of r){const n=a.slice(0,s.length);for(;n.length<s.length;)n.push("");const i={};for(let c=0;c<s.length;c++)i[s[c]]=n[c]??"";Object.values(i).every(c=>String(c??"").trim().length===0)||o.push(i)}return o}async getObjectsWithIndex(e){const t=await this.getSheetMatrix(e);if(t.length===0)return[];const s=await this.getHeaders(e),r=[];for(let o=1;o<t.length;o++){const n=(t[o]??[]).slice(0,s.length);for(;n.length<s.length;)n.push("");const i={};s.forEach((h,c)=>i[h]=n[c]??""),r.push({rowIndex:o,rowNumberA1:o+1,object:i})}return r}mapObjectToRow(e,t){return t.map(s=>e[s]??"")}async appendRowByHeader(e,t){const s=await this.getHeaders(e);if(s.length===0)throw new Error("Cabeçalhos não encontrados na planilha.");const r=[this.mapObjectToRow(t,s)],o=`${e}!A1`,a=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${o}:append?valueInputOption=RAW`;await this.request(a,"POST",{values:r})}colToA1(e){let t="",s=e;for(;s>=0;)t=String.fromCharCode(s%26+65)+t,s=Math.floor(s/26)-1;return t}async updateRowByIndex(e,t,s){if(!Number.isInteger(t)||t<1)throw new Error("rowIndex inválido (0 é cabeçalho; use >= 1).");const r=await this.getSheetMatrix(e),o=await this.getHeaders(e);if(r.length===0||o.length===0)throw new Error(`Aba "${e}" vazia.`);if(t>=r.length)throw new Error(`rowIndex ${t} fora dos limites da aba "${e}".`);const a=r[t]??[],n=o.map((l,u)=>{const p=Object.prototype.hasOwnProperty.call(s,l);return String(p?s[l]??"":a[u]??"")}),i=this.colToA1(o.length-1),h=`${e}!A${t+1}:${i}${t+1}`,c=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(h)}?valueInputOption=USER_ENTERED`;await this.request(c,"PUT",{range:h,majorDimension:"ROWS",values:[n]})}async softDeleteRowByIndex(e,t){if(!Number.isInteger(t)||t<1)throw new Error("rowIndex inválido (0 é cabeçalho; use >= 1).");const s=await this.getHeaders(e),r=await this.getSheetMatrix(e);if(r.length===0||s.length===0)throw new Error(`Aba "${e}" vazia.`);if(t>=r.length)throw new Error(`rowIndex ${t} fora dos limites da aba "${e}".`);const o=s.map(()=>"-"),a=this.colToA1(s.length-1),n=`${e}!A${t+1}:${a}${t+1}`,i=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(n)}?valueInputOption=USER_ENTERED`;await this.request(i,"PUT",{range:n,majorDimension:"ROWS",values:[o]})}}export{m as S};
