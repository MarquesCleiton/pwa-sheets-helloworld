(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}})();function s(a){window.location.href=`/pwa-sheets-helloworld/${a}`}class i{static clientId;static init(o){if(this.clientId=o,!window.google||!window.google.accounts?.id){console.error("Google Identity Services não foi carregado.");return}window.google.accounts.id.initialize({client_id:this.clientId,callback:this.handleCredentialResponse.bind(this),auto_select:!1});const t=document.getElementById("googleSignInBtn");t&&window.google.accounts.id.renderButton(t,{theme:"outline",size:"large",type:"standard"}),window.google.accounts.id.prompt()}static handleCredentialResponse(o){const t=o.credential;if(!t){console.error("Token inválido no login.");return}const r=i.decodeJwt(t);localStorage.setItem("token",t),localStorage.setItem("user",JSON.stringify({name:r.name,email:r.email,picture:r.picture,exp:r.exp})),s("pages/cadastro.html")}static isAuthenticated(){const o=localStorage.getItem("token"),t=localStorage.getItem("user");if(!o||!t)return!1;try{const{exp:r}=JSON.parse(t),e=Math.floor(Date.now()/1e3);return r>e}catch{return!1}}static getUser(){const o=localStorage.getItem("user");if(!o)return null;try{const t=JSON.parse(o);return{name:t.name,email:t.email,picture:t.picture}}catch{return null}}static getToken(){return localStorage.getItem("token")}static logout(){localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login.html"}static decodeJwt(o){const r=o.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),e=decodeURIComponent(atob(r).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(e)}}const l="338305920567-bhd608ebcip1u08qf0gb5f08o4je4dnp.apps.googleusercontent.com";window.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("loginStatus"),o=setInterval(async()=>{if(window.google&&window.google.accounts?.id){clearInterval(o);try{await i.init(l),i.isAuthenticated()&&(a.textContent="Você já está logado!",a.className="alert alert-success",s("pages/cadastro.html"))}catch(t){console.error("Erro na inicialização do login:",t),a.textContent="Erro ao carregar autenticação.",a.className="alert alert-danger"}}},100)});
