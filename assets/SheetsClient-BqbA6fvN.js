import{G as l}from"./GoogleAuthManager-YBajxLns.js";class w{sheetId;constructor(e="19B2aMGrajvhPJfOvYXt059-fECytaN38iFsP8GInD_g"){this.sheetId=e}async getObjectByIndex(e,t){if(!Number.isInteger(t)||t<1)throw new Error("rowIndex inválido (0 é o cabeçalho; use >= 1).");const o=await this.getHeaders(e);if(o.length===0)throw new Error(`Cabeçalho da aba "${e}" não encontrado.`);const a=await this.getRowArrayByIndex(e,t);if(!a)return null;const s=a.slice(0,o.length);for(;s.length<o.length;)s.push("");const i={};return o.forEach((n,r)=>{i[n]=String(s[r]??"")}),{rowIndex:t,rowNumberA1:t+1,object:i}}async getAccessToken(){await l.authenticate();const e=l.getAccessToken();if(!e)throw new Error("Token de acesso inválido ou ausente.");return e}async getHeadersInit(){return{Authorization:`Bearer ${await this.getAccessToken()}`,"Content-Type":"application/json",Accept:"application/json"}}async request(e,t="GET",o){const a=await this.getHeadersInit(),s=await fetch(e,{method:t,headers:a,body:o?JSON.stringify(o):void 0});if(!s.ok){let n={};try{n=await s.json()}catch{}throw console.error("Erro na requisição ao Google Sheets:",n),new Error(n?.error?.message||`Erro ao acessar o Google Sheets (HTTP ${s.status}).`)}if(!(s.headers.get("content-type")||"").includes("application/json"))try{const n=await s.text();return n?JSON.parse(n):void 0}catch{return}return await s.json()}async getSheetMatrix(e){const t=encodeURIComponent(e),o=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${t}?majorDimension=ROWS`;return(await this.request(o,"GET")).values??[]}async getHeaders(e){const t=await this.getSheetMatrix(e);return t.length===0?[]:(t[0]??[]).map((a,s)=>{const i=String(a??"").trim();return i.length?i:`col_${s+1}`})}async getSheetObjects(e){const t=await this.getSheetMatrix(e);if(t.length===0)return[];const o=(t[0]??[]).map((i,n)=>{const r=String(i??"").trim();return r.length?r:`col_${n+1}`}),a=t.slice(1),s=[];for(const i of a){const n=i.slice(0,o.length);for(;n.length<o.length;)n.push("");const r={};for(let c=0;c<o.length;c++)r[o[c]]=n[c]??"";Object.values(r).every(c=>String(c??"").trim().length===0)||s.push(r)}return s}async getObjectsWithIndex(e){const t=await this.getSheetMatrix(e);if(t.length===0)return[];const o=await this.getHeaders(e),a=[];for(let s=1;s<t.length;s++){const n=(t[s]??[]).slice(0,o.length);for(;n.length<o.length;)n.push("");const r={};o.forEach((h,c)=>r[h]=n[c]??""),a.push({rowIndex:s,rowNumberA1:s+1,object:r})}return a}mapObjectToRow(e,t){return t.map(o=>e[o]??"")}async appendRowByHeader(e,t){const o=await this.getHeaders(e);if(o.length===0)throw new Error("Cabeçalhos não encontrados na planilha.");const a=[this.mapObjectToRow(t,o)],s=`${e}!A1`,i=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(s)}:append?valueInputOption=RAW`;await this.request(i,"POST",{values:a})}colToA1(e){let t="",o=e;for(;o>=0;)t=String.fromCharCode(o%26+65)+t,o=Math.floor(o/26)-1;return t}async getRowArrayByIndex(e,t){const o=await this.getHeaders(e);if(o.length===0)return null;const a=this.colToA1(o.length-1),s=`${e}!A${t+1}:${a}${t+1}`,i=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(s)}?majorDimension=ROWS`,r=(await this.request(i,"GET")).values?.[0]??[];return r.length===0||r.every(c=>c===""||c==null)?null:r.map(c=>(c??"").toString())}async updateRowByIndex(e,t,o){if(!Number.isInteger(t)||t<1)throw new Error("rowIndex inválido (0 é cabeçalho; use >= 1).");const a=await this.getHeaders(e);if(a.length===0)throw new Error(`Cabeçalho da aba "${e}" não encontrado.`);const s=await this.getRowArrayByIndex(e,t);if(!s)throw new Error(`Linha ${t} não existe (ou está totalmente vazia).`);const i=a.map((c,g)=>{const u=Object.prototype.hasOwnProperty.call(o,c);return String(u?o[c]??"":s[g]??"")}),n=this.colToA1(a.length-1),r=`${e}!A${t+1}:${n}${t+1}`,h=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(r)}?valueInputOption=USER_ENTERED`;await this.request(h,"PUT",{range:r,majorDimension:"ROWS",values:[i]})}async softDeleteRowByIndex(e,t){if(!Number.isInteger(t)||t<1)throw new Error("rowIndex inválido (0 é cabeçalho; use >= 1).");const o=await this.getHeaders(e);if(o.length===0)throw new Error(`Cabeçalho da aba "${e}" não encontrado.`);if(!await this.getRowArrayByIndex(e,t))throw new Error(`Linha ${t} não existe (ou está totalmente vazia).`);const s=o.map(()=>"-"),i=this.colToA1(o.length-1),n=`${e}!A${t+1}:${i}${t+1}`,r=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values/${encodeURIComponent(n)}?valueInputOption=USER_ENTERED`;await this.request(r,"PUT",{range:n,majorDimension:"ROWS",values:[s]})}}export{w as S};
