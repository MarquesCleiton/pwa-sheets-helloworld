import"./GoogleAuthManager-YBajxLns.js";import{D as H,S as R}from"./DriveClient-CRU4MlfE.js";import{l as T}from"./loadNavbar-6w5EyZrw.js";import"./navigation-Cl-AB2MO.js";const e=s=>document.querySelector(s),x=e("#cadastroForm"),U=e("#nome"),F=e("#email"),$=e("#obs"),a=e("#imagem"),u=e("#imgDrop"),o=e("#imgPreview"),E=e("#imgDelete"),j=e("#imgRetake"),O=e("#imgActions"),A=e("#imgPlaceholder"),m=e("#authAlert"),D=e("#status"),i=e("#btnSalvar");function p(s,t="warning"){m&&(m.className=`alert alert-${t}`,m.textContent=s,m.classList.remove("d-none"))}function q(){m?.classList.add("d-none")}function d(s){D&&(D.textContent=s)}function z(s){A?.classList.add("d-none"),o&&(o.src=s,o.classList.remove("d-none")),E?.classList.remove("d-none"),O?.classList.remove("d-none"),u&&(u.style.minHeight="220px")}function L(){a&&(a.value=""),o&&(o.src="",o.classList.add("d-none")),E?.classList.add("d-none"),O?.classList.add("d-none"),A?.classList.remove("d-none"),u&&(u.style.minHeight="140px")}document.addEventListener("DOMContentLoaded",()=>{T(),u?.addEventListener("click",t=>{t.target.closest("#imgDelete")||a?.click()}),j?.addEventListener("click",()=>a?.click()),E?.addEventListener("click",t=>{t.stopPropagation(),L()}),a?.addEventListener("change",()=>{const t=a.files?.[0];if(!t){L();return}const r=URL.createObjectURL(t);z(r)}),document.getElementById("btnSair")?.addEventListener("click",()=>{try{localStorage.removeItem("user"),localStorage.removeItem("accessToken")}catch{}window.location.href="/index.html"})});const b=new H,G=b.ensurePath(["Cadastro","Imagens"]);let w=!1;x?.addEventListener("submit",async s=>{if(s.preventDefault(),w)return;w=!0,q(),d("");const t="Cadastro",r=new R;i&&(i.disabled=!0,i.innerHTML='<span class="spinner-border spinner-border-sm me-1"></span>Salvando…');try{const f=(U?.value||"").trim(),v=(F?.value||"").trim(),B=($?.value||"").trim();if(!f||!v){p("Preencha Nome e E-mail.","warning");return}const[S,M]=await Promise.all([r.getHeaders(t),G]),g=a?.files?.[0]||null;let h="";if(g){if(!g.type.startsWith("image/"))throw new Error("Selecione uma imagem válida.");if(g.size>5*1024*1024)throw new Error("Imagem muito grande (máx. 5 MB).");d("Enviando imagem…");const n=await b.uploadImage(g,M);await b.setPublic(n.id),h=H.viewUrl(n.id)}const N=S.map(n=>n.toLowerCase()),c=n=>{const y=N.indexOf(n.toLowerCase());return y>=0?S[y]:null},l={},C=c("Nome");C&&(l[C]=f);const I=c("Email");I&&(l[I]=v);const P=c("Observações")||c("Observacoes");P&&(l[P]=B);const k=c("Imagem");k&&h&&(l[k]=h),d("Gravando cadastro…"),await r.appendRowByHeader(t,l),p("Cadastro criado com sucesso!","success"),d("Cadastro criado com sucesso!"),await r.upsertMeta(t),L(),x?.reset()}catch(f){p(f?.message||"Erro ao salvar cadastro.","danger"),d("")}finally{w=!1,i&&(i.disabled=!1,i.innerHTML='<i class="bi bi-check2-circle me-1"></i>Salvar')}});
