import"./GoogleAuthManager-lBYSKgkx.js";import{D as O,S as N}from"./DriveClient-BojxZt8p.js";import{b as T}from"./navigation-Cl-AB2MO.js";async function B(){console.log("Carregando Navbar");const e=await fetch(T("src/presentation/componentes/navbar.html")).then(o=>o.text()),a=document.createElement("div");a.innerHTML=e;const n=a.querySelector("nav");if(!n)return;const s=n.querySelectorAll(".nav-link"),p=window.location.pathname;s.forEach(o=>{const r=o.getAttribute("href");r&&p.includes(r)&&(o.classList.add("nav-active"),o.addEventListener("click",u=>{u.preventDefault()}))}),document.body.appendChild(n),document.body.style.paddingBottom="70px"}const z="1zId11Ydti8d0FOQoQjd9lQmPo6GiJx26",w="Cadastro",F="/pwa-sheets-helloworld/",t=e=>document.querySelector(e),A=t("#cadastroForm"),U=t("#nome"),$=t("#email"),q=t("#obs"),i=t("#imagem"),h=t("#imgDrop"),m=t("#imgPreview"),E=t("#imgDelete"),Q=t("#imgRetake"),I=t("#imgActions"),R=t("#imgPlaceholder"),v=t("#authAlert"),H=t("#status"),l=t("#btnSalvar"),j=t("#btnSair");document.addEventListener("DOMContentLoaded",()=>{B(),console.log("[Cadastro] Navbar carregada.")});function L(e,a="warning"){v&&(v.className=`alert alert-${a}`,v.textContent=e,v.classList.remove("d-none"),console.log("[Cadastro] ALERT:",a,e))}function G(){v?.classList.add("d-none")}function d(e){H&&(H.textContent=e),console.log("[Cadastro] STATUS:",e)}function _(e){R?.classList.add("d-none"),m&&(m.src=e,m.classList.remove("d-none")),E?.classList.remove("d-none"),I?.classList.remove("d-none"),h&&(h.style.minHeight="220px")}function C(){i&&(i.value=""),m&&(m.src="",m.classList.add("d-none")),E?.classList.add("d-none"),I?.classList.add("d-none"),R?.classList.remove("d-none"),h&&(h.style.minHeight="140px")}h?.addEventListener("click",e=>{e.target.closest("#imgDelete")||i?.click()});Q?.addEventListener("click",()=>i?.click());E?.addEventListener("click",e=>{e.stopPropagation(),C()});i?.addEventListener("change",()=>{const e=i.files?.[0];if(!e){C();return}const a=URL.createObjectURL(e);_(a),console.log("[Cadastro] Preview atualizado:",{name:e.name,type:e.type,size:e.size})});j?.addEventListener("click",()=>{console.log("[Cadastro] Logout");try{localStorage.removeItem("user"),localStorage.removeItem("accessToken")}catch{}window.location.href=`${F}index.html`});const P=new O;let b=!1;A?.addEventListener("submit",async e=>{if(e.preventDefault(),b)return;b=!0,G(),d("");const a=new N;l&&(l.disabled=!0,l.innerHTML='<span class="spinner-border spinner-border-sm me-1"></span>Salvando…');try{const n=(U?.value||"").trim(),s=($?.value||"").trim(),p=(q?.value||"").trim();if(!n||!s){L("Preencha Nome e E-mail.","warning");return}d("Carregando cabeçalhos…");const o=await a.getHeaders(w),r=i?.files?.[0]||null;let u="";if(r){if(!r.type.startsWith("image/"))throw new Error("Selecione uma imagem válida.");if(r.size>5*1024*1024)throw new Error("Imagem muito grande (máx. 5 MB).");d("Enviando imagem…");const c=await P.uploadImage(r,z);await P.setPublic(c.id),u=O.viewUrl(c.id)}const M=o.map(c=>String(c||"").toLowerCase()),f=c=>{const k=M.indexOf(c.toLowerCase());return k>=0?o[k]:null},g={},S=f("Nome");S&&(g[S]=n);const y=f("Email");y&&(g[y]=s);const D=f("Observações")||f("Observacoes");D&&(g[D]=p);const x=f("Imagem");x&&u&&(g[x]=u),d("Gravando cadastro…"),await a.appendRowByHeader(w,g),await a.upsertMeta(w),L("Cadastro criado com sucesso!","success"),d("Cadastro criado com sucesso!"),C(),A?.reset()}catch(n){const s=n;console.error("[Cadastro] Erro:",s),L(s?.message||"Erro ao salvar cadastro.","danger"),d("")}finally{b=!1,l&&(l.disabled=!1,l.innerHTML='<i class="bi bi-check2-circle me-1"></i>Salvar')}});
