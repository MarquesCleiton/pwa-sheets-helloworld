import"./modulepreload-polyfill-B5Qt9EMX.js";function s(n){window.location.href=`/pwa-sheets-helloworld/${n}`}const i="https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.file";class c{static clientId;static init(t){if(this.clientId=t,!window.google||!window.google.accounts?.id){console.error("Google Identity Services não foi carregado.");return}window.google.accounts.id.initialize({client_id:this.clientId,callback:this.handleCredentialResponse.bind(this),auto_select:!1});const e=document.getElementById("googleSignInBtn");e&&window.google.accounts.id.renderButton(e,{theme:"outline",size:"large",type:"standard"}),window.google.accounts.id.prompt()}static async handleCredentialResponse(t){const e=t.credential;if(!e){console.error("Token inválido no login.");return}const o=c.decodeJwt(e);localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify({name:o.name,email:o.email,picture:o.picture,exp:o.exp}));try{(await window.google.accounts.oauth2.tokenClient({client_id:this.clientId,scope:i,callback:r=>{if(r.error){console.error("Erro ao obter access_token:",r);return}localStorage.setItem("accessToken",r.access_token),s("src/presentation/pages/cadastro.html")}})).requestAccessToken()}catch(a){console.error("Erro ao requisitar access token:",a)}}static isAuthenticated(){const t=localStorage.getItem("token"),e=localStorage.getItem("user");if(!t||!e)return!1;try{const{exp:o}=JSON.parse(e),a=Math.floor(Date.now()/1e3);return o>a}catch{return!1}}static getUser(){const t=localStorage.getItem("user");if(!t)return null;try{const e=JSON.parse(t);return{name:e.name,email:e.email,picture:e.picture}}catch{return null}}static getToken(){return localStorage.getItem("accessToken")}static logout(){localStorage.removeItem("token"),localStorage.removeItem("accessToken"),localStorage.removeItem("user"),window.location.href="/login.html"}static decodeJwt(t){const o=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(atob(o).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(a)}}const l="338305920567-bhd608ebcip1u08qf0gb5f08o4je4dnp.apps.googleusercontent.com";window.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("loginStatus"),t=setInterval(async()=>{if(window.google&&window.google.accounts?.id){clearInterval(t);try{await c.init(l),c.isAuthenticated()&&(n.textContent="Você já está logado!",n.className="alert alert-success",s("src/presentation/pages/cadastro.html"))}catch(e){console.error("Erro na inicialização do login:",e),n.textContent="Erro ao carregar autenticação.",n.className="alert alert-danger"}}},100)});
