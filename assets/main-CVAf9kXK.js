import"./modulepreload-polyfill-B5Qt9EMX.js";function c(a){window.location.href=`/pwa-sheets-helloworld/${a}`}const i="https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.file";class s{static clientId;static init(t){if(this.clientId=t,!window.google||!window.google.accounts?.id){console.error("Google Identity Services não foi carregado.");return}window.google.accounts.id.initialize({client_id:this.clientId,callback:this.handleCredentialResponse.bind(this),auto_select:!1});const e=document.getElementById("googleSignInBtn");e&&window.google.accounts.id.renderButton(e,{theme:"outline",size:"large",type:"standard"}),window.google.accounts.id.prompt()}static handleCredentialResponse(t){const e=t.credential;if(!e){console.error("Token de ID inválido.");return}const o=s.decodeJwt(e);localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify({name:o.name,email:o.email,picture:o.picture,exp:o.exp})),this.requestAccessTokenSilentFirst()}static requestAccessTokenSilentFirst(){let t=!1;const e=()=>{window.google.accounts.oauth2.initTokenClient({client_id:this.clientId,scope:i,prompt:t?"consent":"",callback:n=>{if(n.error){if(!t){t=!0,e();return}console.error("Erro ao obter access_token:",n);return}localStorage.setItem("accessToken",n.access_token),c("src/presentation/pages/cadastro.html")}}).requestAccessToken()};e()}static isAuthenticated(){const t=localStorage.getItem("token"),e=localStorage.getItem("user");if(!t||!e)return!1;try{const{exp:o}=JSON.parse(e),n=Math.floor(Date.now()/1e3);return o>n}catch{return!1}}static getUser(){const t=localStorage.getItem("user");if(!t)return null;try{const e=JSON.parse(t);return{name:e.name,email:e.email,picture:e.picture}}catch{return null}}static getToken(){return localStorage.getItem("accessToken")}static logout(){localStorage.removeItem("token"),localStorage.removeItem("accessToken"),localStorage.removeItem("user"),window.location.href="/login.html"}static decodeJwt(t){const o=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(o).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(n)}}const l="338305920567-bhd608ebcip1u08qf0gb5f08o4je4dnp.apps.googleusercontent.com";window.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("loginStatus"),t=setInterval(async()=>{if(window.google&&window.google.accounts?.id&&window.google.accounts?.oauth2){clearInterval(t);try{await s.init(l),s.isAuthenticated()&&(a.textContent="Você já está logado!",a.className="alert alert-success",c("src/presentation/pages/cadastro.html"))}catch(o){console.error("Erro na inicialização do login:",o),a.textContent="Erro ao carregar autenticação.",a.className="alert alert-danger"}}},100)});
